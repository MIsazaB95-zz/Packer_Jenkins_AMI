---
# tasks file

- name: update_packages
  apt:
          name: '*'
          update_cache: yes

- name: install packages to allow apt to use repository over HTTPS
  apt:
          name:
                  - apt-transport-https
                  - ca-certificates
                  - curl
                  - gnupg-agent
                  - software-properties-common

- name: add docker engine official gpg key
  apt_key:
          url: https://download.docker.com/linux/ubuntu/gpg
          state: present

- name: setting up a stable repository
  shell: |
          sudo add-apt-repository \ 
          "deb [arch=amd64] https://download.docker.com/linux/ubuntu \ 
          $(lsb_release -cs) \ 
          stable"
  args:
          warn: no

- name: update_packages
  apt:
          name: '*'
          update_cache: yes

- name: install the latest docker engine community
  apt:
          name:
                  - docker-ce
                  - docker-ce-cli
                  - containerd.io
          state: latest

- name: install docker-compose
  shell: |
          curl -L "https://github.com/docker/compose/releases/download/1.25.4/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
          sudo chmod +x /usr/local/bin/docker-compose
  args:
          warn: no

- name: check docker-composer version
  command: docker-compose --version
  register: compose_version

- name: checking the version of docker-compose
  debug:
          var: compose_version.stdout

- name: add user to docker group
  user:
          name: ubuntu
          group: docker
          append: true
